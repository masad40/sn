<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - TerrorRat</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-black: #0a0a0f;
            --deep-gray: #15151e;
            --card-gray: #1a1a25;
            --neon-green: #00ff9d;
            --neon-cyan: #00eeff;
            --neon-purple: #9d4edd;
            --text-light: #e0e0ff;
            --text-gray: #a0a0c0;
            --cyber-font: 'Orbitron', sans-serif;
            --mono-font: 'Space Mono', monospace;
        }

        body {
            font-family: var(--mono-font);
            background-color: var(--primary-black);
            color: var(--text-light);
            display: flex;
        }

        .sidebar {
            width: 250px;
            background-color: var(--deep-gray);
            border-right: 1px solid var(--neon-green);
            padding: 30px 20px;
            height: 100vh;
            overflow-y: auto;
            position: fixed;
            left: 0;
            top: 0;
        }

        .sidebar-header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 2px solid var(--neon-green);
            padding-bottom: 20px;
        }

        .sidebar-header h2 {
            font-family: var(--cyber-font);
            color: var(--neon-green);
            font-size: 1.5rem;
            letter-spacing: 1px;
        }

        /* Toast notification */
        .toast {
            position: fixed;
            right: 24px;
            bottom: 24px;
            background: rgba(10,10,15,0.95);
            color: var(--text-light);
            padding: 10px 14px;
            border-radius: 8px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.6);
            border: 1px solid rgba(157,78,221,0.08);
            transform: translateY(20px);
            opacity: 0;
            transition: transform 260ms cubic-bezier(.2,.9,.2,1), opacity 260ms ease;
            z-index: 2000;
            font-size: 0.95rem;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 15px;
        }

        .sidebar-menu a {
            display: block;
            padding: 12px 15px;
            color: var(--text-gray);
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .sidebar-menu a:hover,
        .sidebar-menu a.active {
            color: var(--neon-green);
            border-left-color: var(--neon-green);
            background-color: rgba(0, 255, 157, 0.1);
        }

        .main-content {
            margin-left: 250px;
            flex: 1;
            padding: 30px;
            height: 100vh;
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            border-bottom: 1px solid rgba(0, 255, 157, 0.2);
            padding-bottom: 20px;
        }

        .header h1 {
            font-family: var(--cyber-font);
            color: var(--neon-cyan);
            font-size: 2rem;
            letter-spacing: 1px;
        }

        .logout-btn {
            padding: 10px 25px;
            background-color: transparent;
            color: #ff0040;
            border: 2px solid #ff0040;
            font-family: var(--cyber-font);
            font-weight: 600;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .logout-btn:hover {
            background-color: #ff0040;
            color: var(--primary-black);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .card {
            background-color: var(--card-gray);
            border: 1px solid rgba(0, 255, 157, 0.1);
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .card h3 {
            color: var(--neon-cyan);
            margin-bottom: 20px;
            font-size: 1.3rem;
            border-bottom: 2px solid var(--neon-green);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            color: var(--neon-cyan);
            font-family: var(--cyber-font);
            font-size: 0.9rem;
            margin-bottom: 8px;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 12px;
            background-color: rgba(10, 10, 15, 0.7);
            border: 1px solid rgba(0, 255, 157, 0.3);
            border-radius: 4px;
            color: var(--text-light);
            font-family: var(--mono-font);
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--neon-cyan);
            box-shadow: 0 0 15px rgba(0, 238, 255, 0.2);
        }

        .form-textarea {
            min-height: 150px;
            resize: vertical;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 4px;
            font-family: var(--cyber-font);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .btn-primary {
            background-color: var(--neon-green);
            color: var(--primary-black);
        }

        .btn-primary:hover {
            box-shadow: 0 0 20px rgba(0, 255, 157, 0.5);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--neon-cyan);
            border: 1px solid var(--neon-cyan);
        }

        .btn-secondary:hover {
            background-color: var(--neon-cyan);
            color: var(--primary-black);
        }

        .btn-danger {
            background-color: transparent;
            color: #ff0040;
            border: 1px solid #ff0040;
        }

        .btn-danger:hover {
            background-color: #ff0040;
            color: var(--primary-black);
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .gallery-item {
            background-color: var(--deep-gray);
            border: 1px solid rgba(0, 255, 157, 0.1);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .gallery-preview {
            width: 100%;
            height: 150px;
            background-color: rgba(0, 255, 157, 0.05);
            border: 2px dashed var(--neon-green);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            color: var(--text-gray);
            font-size: 2rem;
        }

        .gallery-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 4px;
        }

        .item-list {
            list-style: none;
        }

        .item-list li {
            background-color: var(--deep-gray);
            border: 1px solid rgba(0, 255, 157, 0.1);
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .item-info h4 {
            color: var(--neon-cyan);
            margin-bottom: 5px;
        }

        .item-info p {
            color: var(--text-gray);
            font-size: 0.85rem;
        }

        .item-actions {
            display: flex;
            gap: 8px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem;
        }

        .success-message {
            background-color: rgba(0, 255, 157, 0.1);
            color: var(--neon-green);
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            border-left: 3px solid var(--neon-green);
            display: none;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>> ADMIN</h2>
        </div>
        <ul class="sidebar-menu">
            <li><a class="menu-link active" data-section="dashboard">Dashboard</a></li>
            <li><a class="menu-link" data-section="gallery">Manage Gallery</a></li>
            <li><a class="menu-link" data-section="services">Manage Services</a></li>
            <li><a class="menu-link" data-section="settings">Settings</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="header">
            <h1>Admin Control Panel</h1>
            <button class="logout-btn" id="logout-btn">Logout</button>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard" class="section active">
            <div class="card">
                <h3>Dashboard Overview</h3>
                <p>Welcome to the TerrorRat Admin Panel. Use the menu on the left to manage your website content.</p>
                <ul style="margin-top: 20px; margin-left: 20px; color: var(--text-gray);">
                    <li style="margin-bottom: 10px;">üì∏ <strong>Manage Gallery:</strong> Add or edit photos in the about section</li>
                    <li style="margin-bottom: 10px;">üõ†Ô∏è <strong>Manage Services:</strong> Add, edit, or remove tools and courses</li>
                    <li style="margin-bottom: 10px;">‚öôÔ∏è <strong>Settings:</strong> Update your profile information</li>
                </ul>
            </div>
        </div>

        <!-- Gallery Section -->
        <div id="gallery" class="section">
            <div class="success-message" id="gallery-success"></div>

            <div class="card">
                <h3>Manage Gallery Photos</h3>
                <p style="color: var(--text-gray); margin-bottom: 20px;">Add or update photos for the about section gallery (4 items)</p>

                <div class="gallery-grid" id="gallery-grid">
                    <!-- Gallery items will be populated here -->
                </div>
            </div>
        </div>

        <!-- Services Section -->
        <div id="services" class="section">
            <div class="success-message" id="services-success"></div>

            <div class="card">
                <h3>Add New Tool</h3>
                <form id="tool-form">
                    <div class="two-column">
                        <div class="form-group">
                            <label class="form-label">Tool Name</label>
                            <input type="text" id="tool-name" class="form-input" placeholder="e.g., VulnScan Pro" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Icon Class (FontAwesome)</label>
                            <input type="text" id="tool-icon" class="form-input" placeholder="e.g., fas fa-search" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tool Image (optional)</label>
                        <input type="file" id="tool-image" class="form-input" accept="image/*">
                        <small style="color: var(--text-gray);">Upload a tool image (PNG, JPG, GIF)</small>
                        <div id="tool-image-preview" style="margin-top: 10px; display: none;">
                            <img id="tool-image-preview-img" src="" alt="Preview" style="max-width: 200px; border-radius: 6px; border: 1px solid rgba(157, 78, 221, 0.2);">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea id="tool-description" class="form-textarea" placeholder="Describe the tool" required></textarea>
                    </div>
                    <div class="two-column">
                        <div class="form-group">
                            <label class="form-label">Button Text (optional)</label>
                            <input type="text" id="tool-button-text" class="form-input" placeholder="e.g., Get Tool">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Button Action</label>
                            <select id="tool-button-type" class="form-select">
                                <option value="none">None</option>
                                <option value="internal">Internal (anchor)</option>
                                <option value="external">External (URL)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Button Target (anchor or URL)</label>
                        <input type="text" id="tool-button-target" class="form-input" placeholder="#contact or https://example.com">
                    </div>
                    <div class="two-column">
                        <div class="form-group">
                            <label class="form-label">Button Icon (FontAwesome class)</label>
                            <input type="text" id="tool-button-icon" class="form-input" placeholder="e.g., fas fa-download">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Button Color</label>
                            <input type="color" id="tool-button-color" class="form-input" value="#9d4edd">
                        </div>
                    </div>
                    <input type="hidden" id="tool-edit-id" value="">
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Add Tool</button>
                        <button type="reset" class="btn btn-secondary">Clear</button>
                    </div>
                </form>
            </div>

            <div class="card">
                <h3>Tools List</h3>
                <ul class="item-list" id="tools-list">
                    <!-- Tools will be populated here -->
                </ul>
            </div>

            <div class="card">
                <h3>Add New Course</h3>
                <form id="course-form">
                    <div class="two-column">
                        <div class="form-group">
                            <label class="form-label">Course Name</label>
                            <input type="text" id="course-name" class="form-input" placeholder="e.g., TerrorRat Fundamentals" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Level</label>
                            <select id="course-level" class="form-select" required>
                                <option value="Beginner">Beginner</option>
                                <option value="Intermediate">Intermediate</option>
                                <option value="Advanced">Advanced</option>
                                <option value="Pro">Pro</option>
                            </select>
                        </div>
                    </div>
                    <div class="two-column">
                        <div class="form-group">
                            <label class="form-label">Icon Class (FontAwesome)</label>
                            <input type="text" id="course-icon" class="form-input" placeholder="e.g., fas fa-graduation-cap" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Course Image (optional)</label>
                            <input type="file" id="course-image" class="form-input" accept="image/*">
                        </div>
                    </div>
                    <div class="form-group">
                        <small style="color: var(--text-gray);">Upload a course image (PNG, JPG, GIF)</small>
                        <div id="course-image-preview" style="margin-top: 10px; display: none;">
                            <img id="course-image-preview-img" src="" alt="Preview" style="max-width: 200px; border-radius: 6px; border: 1px solid rgba(157, 78, 221, 0.2);">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea id="course-description" class="form-textarea" placeholder="Describe the course" required></textarea>
                    </div>
                    <div class="two-column">
                        <div class="form-group">
                            <label class="form-label">Button Text (optional)</label>
                            <input type="text" id="course-button-text" class="form-input" placeholder="e.g., Enroll">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Button Action</label>
                            <select id="course-button-type" class="form-select">
                                <option value="none">None</option>
                                <option value="internal">Internal (anchor)</option>
                                <option value="external">External (URL)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Button Target (anchor or URL)</label>
                        <input type="text" id="course-button-target" class="form-input" placeholder="#contact or https://example.com">
                    </div>
                    <div class="two-column">
                        <div class="form-group">
                            <label class="form-label">Button Icon (FontAwesome class)</label>
                            <input type="text" id="course-button-icon" class="form-input" placeholder="e.g., fas fa-play">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Button Color</label>
                            <input type="color" id="course-button-color" class="form-input" value="#9d4edd">
                        </div>
                    </div>
                    <input type="hidden" id="course-edit-id" value="">
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Add Course</button>
                        <button type="reset" class="btn btn-secondary">Clear</button>
                    </div>
                </form>
            </div>

            <div class="card">
                <h3>Courses List</h3>
                <ul class="item-list" id="courses-list">
                    <!-- Courses will be populated here -->
                </ul>
            </div>
        </div>

        <!-- Settings Section -->
        <div id="settings" class="section">
            <div class="success-message" id="settings-success"></div>

            <div class="card">
                <h3>Admin Credentials</h3>
                <form id="credentials-form">
                    <div class="form-group">
                        <label class="form-label">New Username</label>
                        <input type="text" id="new-username" class="form-input" placeholder="Leave blank to keep current">
                    </div>
                    <div class="form-group">
                        <label class="form-label">New Password</label>
                        <input type="password" id="new-password" class="form-input" placeholder="Leave blank to keep current">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Confirm Password</label>
                        <input type="password" id="confirm-password" class="form-input" placeholder="Confirm new password">
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Update Credentials</button>
                    </div>
                </form>
            </div>
            <div class="card" style="margin-top:16px;">
                <h3>Website Social Links</h3>
                <form id="social-links-form">
                    <div class="form-group">
                        <label class="form-label">GitHub URL</label>
                        <input type="text" id="github-input" class="form-input" placeholder="https://github.com/your-username">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Facebook Profile URL</label>
                        <input type="text" id="fb-profile-input" class="form-input" placeholder="https://facebook.com/your.profile">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Facebook Page URL</label>
                        <input type="text" id="fb-page-input" class="form-input" placeholder="https://facebook.com/your.page">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Instagram URL</label>
                        <input type="text" id="instagram-input" class="form-input" placeholder="https://instagram.com/yourusername">
                    </div>
                    <div class="form-group">
                        <label class="form-label">WhatsApp Number</label>
                        <input type="text" id="whatsapp-input" class="form-input" placeholder="+8801XXXXXXXXX or 8801XXXXXXXXX">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Telegram URL or Username</label>
                        <input type="text" id="telegram-input" class="form-input" placeholder="https://t.me/yourusername or yourusername">
                    </div>
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Save Social Links</button>
                    </div>
                </form>
            </div>
            <div class="card" style="margin-top:16px;">
                <h3>Services Button Settings</h3>
                <form id="section-buttons-form">
                    <div class="form-group">
                        <label class="form-label">Tools Button Text</label>
                        <input type="text" id="tools-button-text" class="form-input" placeholder="e.g., Get Tool / Learn More">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tools Button Action</label>
                        <select id="tools-button-type" class="form-select">
                            <option value="none">None (no button)</option>
                            <option value="internal">Internal anchor (scroll)</option>
                            <option value="external">External URL (open new tab)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tools Button Target (anchor or URL)</label>
                        <input type="text" id="tools-button-target" class="form-input" placeholder="#contact or https://example.com">
                    </div>

                    <hr>

                    <div class="form-group">
                        <label class="form-label">Courses Button Text</label>
                        <input type="text" id="courses-button-text" class="form-input" placeholder="e.g., Enroll / Learn More">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Courses Button Action</label>
                        <select id="courses-button-type" class="form-select">
                            <option value="none">None (no button)</option>
                            <option value="internal">Internal anchor (scroll)</option>
                            <option value="external">External URL (open new tab)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Courses Button Target (anchor or URL)</label>
                        <input type="text" id="courses-button-target" class="form-input" placeholder="#contact or https://example.com">
                    </div>

                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">Save Section Buttons</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Security: Disable right-click context menu
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });

        // Security: Disable keyboard shortcuts for dev tools and view source
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F12' || 
                (e.ctrlKey && e.shiftKey && e.key === 'I') ||
                (e.ctrlKey && e.shiftKey && e.key === 'C') ||
                (e.ctrlKey && e.shiftKey && e.key === 'J') ||
                (e.ctrlKey && e.key === 'u') ||
                (e.ctrlKey && e.key === 's')) {
                e.preventDefault();
                return false;
            }
        });

        // Security: Disable drag and drop
        document.addEventListener('dragstart', function(e) {
            e.preventDefault();
            return false;
        });

        // Security: Check authentication and session validity
        if (localStorage.getItem('admin_logged_in') !== 'true') {
            window.location.href = 'admin-login.html';
        }

        // Verify session token
        const sessionToken = localStorage.getItem('admin_session_token');
        if (!sessionToken) {
            localStorage.setItem('admin_logged_in', 'false');
            window.location.href = 'admin-login.html';
        }

        // Security: Auto-logout on tab close and inactivity timeout
        const INACTIVITY_TIMEOUT = 30 * 60 * 1000; // 30 minutes
        let inactivityTimer;

        function resetInactivityTimer() {
            clearTimeout(inactivityTimer);
            inactivityTimer = setTimeout(() => {
                alert('Session expired due to inactivity.');
                localStorage.setItem('admin_logged_in', 'false');
                window.location.href = 'admin-login.html';
            }, INACTIVITY_TIMEOUT);
        }

        // Track user activity
        document.addEventListener('click', resetInactivityTimer);
        document.addEventListener('keypress', resetInactivityTimer);
        resetInactivityTimer();

        // Warn before closing tab
        window.addEventListener('beforeunload', () => {
            localStorage.setItem('admin_logged_in', 'false');
        });

        // Sidebar navigation
        document.querySelectorAll('.menu-link').forEach(link => {
            link.addEventListener('click', function() {
                const sectionId = this.getAttribute('data-section');
                
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                document.getElementById(sectionId).classList.add('active');
                
                document.querySelectorAll('.menu-link').forEach(l => l.classList.remove('active'));
                this.classList.add('active');

                if (sectionId === 'gallery') loadGallery();
                if (sectionId === 'services') loadServices();
            });
        });

        // Logout
        document.getElementById('logout-btn').addEventListener('click', function() {
            localStorage.setItem('admin_logged_in', 'false');
            localStorage.removeItem('admin_session_token');
            window.location.href = 'admin-login.html';
        });

        // Initialize data structures
        function initializeData() {
            if (!localStorage.getItem('gallery_items')) {
                const defaultGallery = [
                    { id: 1, title: 'Professional Profile', image: '', icon: 'fas fa-user-secret' },
                    { id: 2, title: 'Security Conference', image: '', icon: 'fas fa-terminal' },
                    { id: 3, title: 'Certifications', image: '', icon: 'fas fa-shield-alt' },
                    { id: 4, title: 'SOC Environment', image: '', icon: 'fas fa-lock' }
                ];
                localStorage.setItem('gallery_items', JSON.stringify(defaultGallery));
            }

            if (!localStorage.getItem('tools')) {
                const defaultTools = [
                    { id: 1, name: 'VulnScan Pro', icon: 'fas fa-search', description: 'Advanced vulnerability scanner with AI-driven threat detection' },
                    { id: 2, name: 'NetShield Suite', icon: 'fas fa-network-wired', description: 'Comprehensive network security toolkit' },
                    { id: 3, name: 'SecureCode Auditor', icon: 'fas fa-code', description: 'Static and dynamic code analysis tool' },
                    { id: 4, name: 'PhishGuard Sentinel', icon: 'fas fa-user-secret', description: 'Advanced phishing simulation platform' }
                ];
                localStorage.setItem('tools', JSON.stringify(defaultTools));
            }

            if (!localStorage.getItem('courses')) {
                const defaultCourses = [
                    { id: 1, name: 'Cybersecurity Fundamentals', level: 'Beginner', icon: 'fas fa-graduation-cap', description: 'Foundational course covering security principles' },
                    { id: 2, name: 'Penetration Testing Masterclass', level: 'Advanced', icon: 'fas fa-skull-crossbones', description: 'Hands-on ethical hacking course' },
                    { id: 3, name: 'AI-Powered Threat Hunting', level: 'Pro', icon: 'fas fa-robot', description: 'Advanced course on ML for threat detection' },
                    { id: 4, name: 'Digital Forensics & Incident Response', level: 'Advanced', icon: 'fas fa-balance-scale', description: 'Master incident investigation' }
                ];
                localStorage.setItem('courses', JSON.stringify(defaultCourses));
            }
        }

        initializeData();

        // Gallery Management
        // Utilities to sanitize output in admin to avoid accidental script injection
        function escapeHTMLAdmin(str) {
            if (str === null || str === undefined) return '';
            return String(str).replace(/[&<>"'`=\/]/g, function (s) {
                return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','`':'&#96;','=':'&#x3D;','/':'&#x2F;'})[s];
            });
        }

        function sanitizeUrlAdmin(url) {
            if (!url) return '#';
            try {
                if (url.startsWith('#') || url.startsWith('/') || url.startsWith('.')) return url;
                const parsed = new URL(url);
                const allowed = ['http:', 'https:', 'mailto:', 'tel:'];
                if (allowed.includes(parsed.protocol)) return parsed.href;
                return '#';
            } catch (e) { return '#'; }
        }
        function loadGallery() {
            const gallery = JSON.parse(localStorage.getItem('gallery_items'));
            const grid = document.getElementById('gallery-grid');
            grid.innerHTML = '';

            gallery.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'gallery-item';
                itemDiv.innerHTML = `
                    <div class="gallery-preview">
                        ${item.image ? `<img src="${item.image}" alt="${item.title}">` : `<i class="${item.icon}"></i>`}
                    </div>
                    <h4 style="color: var(--neon-cyan); margin-bottom: 10px;">${item.title}</h4>
                    <div class="form-group">
                        <input type="file" accept="image/*" id="file-${item.id}" class="form-input" style="padding: 8px;">
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-primary btn-sm" onclick="updateGalleryImage(${item.id}, 'file-${item.id}')">Upload</button>
                        ${item.image ? `<button class="btn btn-danger btn-sm" onclick="removeGalleryImage(${item.id})">Remove</button>` : ''}
                    </div>
                `;
                grid.appendChild(itemDiv);
            });
        }

        function updateGalleryImage(id, fileInputId) {
            const fileInput = document.getElementById(fileInputId);
            const file = fileInput.files[0];
            
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const gallery = JSON.parse(localStorage.getItem('gallery_items'));
                const item = gallery.find(g => g.id === id);
                if (item) {
                    item.image = e.target.result;
                    localStorage.setItem('gallery_items', JSON.stringify(gallery));
                    showMessage('gallery-success', 'Image updated successfully!');
                    loadGallery();
                }
            };
            reader.readAsDataURL(file);
        }

        function removeGalleryImage(id) {
            if (confirm('Remove this image?')) {
                const gallery = JSON.parse(localStorage.getItem('gallery_items'));
                const item = gallery.find(g => g.id === id);
                if (item) {
                    item.image = '';
                    localStorage.setItem('gallery_items', JSON.stringify(gallery));
                    showMessage('gallery-success', 'Image removed successfully!');
                    loadGallery();
                }
            }
        }

        // Services Management
        function loadServices() {
            const tools = JSON.parse(localStorage.getItem('tools'));
            const courses = JSON.parse(localStorage.getItem('courses'));

            const toolsList = document.getElementById('tools-list');
            toolsList.innerHTML = '';
            tools.forEach(tool => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <div class="item-info">
                        <h4><i class="${tool.icon}"></i> ${tool.name}</h4>
                        <p>${tool.description}</p>
                        ${tool.button ? `<p style="font-size:0.9rem; color:var(--text-gray);">Button: <strong>${tool.button.text || ''}</strong> (${tool.button.type || 'none'}) ${tool.button.icon ? `<i class="${tool.button.icon}" style="margin-left:8px;color:${tool.button.color||'#9d4edd'}"></i>` : ''} ` : ''}
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-primary btn-sm" onclick="editTool(${tool.id})">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteTool(${tool.id})">Delete</button>
                    </div>
                `;
                toolsList.appendChild(li);
            });

            const coursesList = document.getElementById('courses-list');
            coursesList.innerHTML = '';
            courses.forEach(course => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <div class="item-info">
                        <h4><i class="${course.icon}"></i> ${course.name}</h4>
                        <p>${course.description}</p>
                        <span style="color: var(--neon-purple); font-size: 0.8rem;">Level: ${course.level}</span>
                        ${course.button ? `<p style="font-size:0.9rem; color:var(--text-gray);">Button: <strong>${course.button.text || ''}</strong> (${course.button.type || 'none'}) ${course.button.icon ? `<i class="${course.button.icon}" style="margin-left:8px;color:${course.button.color||'#9d4edd'}"></i>` : ''}</p>` : ''}
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-primary btn-sm" onclick="editCourse(${course.id})">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteCourse(${course.id})">Delete</button>
                    </div>
                `;
                coursesList.appendChild(li);
            });
        }

        document.getElementById('tool-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const tools = JSON.parse(localStorage.getItem('tools'));
            const editId = document.getElementById('tool-edit-id').value;
            const imageFile = document.getElementById('tool-image').files[0];
            
            const toolObj = {
                name: document.getElementById('tool-name').value,
                icon: document.getElementById('tool-icon').value,
                description: document.getElementById('tool-description').value,
                image: '', // will be populated if image is selected
                button: {
                    text: document.getElementById('tool-button-text').value.trim(),
                    type: document.getElementById('tool-button-type').value,
                    target: document.getElementById('tool-button-target').value.trim(),
                    icon: document.getElementById('tool-button-icon').value.trim(),
                    color: document.getElementById('tool-button-color').value
                }
            };
            
            // Handle image conversion to base64
            if (imageFile) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    toolObj.image = event.target.result; // base64 string
                    
                    if (editId) {
                        const idx = tools.findIndex(t => t.id === parseInt(editId, 10));
                        if (idx > -1) {
                            toolObj.id = parseInt(editId, 10);
                            tools[idx] = toolObj;
                            showMessage('services-success', 'Tool updated successfully!');
                        }
                    } else {
                        toolObj.id = Math.max(...tools.map(t => t.id), 0) + 1;
                        tools.push(toolObj);
                        showMessage('services-success', 'Tool added successfully!');
                    }
                    
                    localStorage.setItem('tools', JSON.stringify(tools));
                    document.getElementById('tool-form').reset();
                    document.getElementById('tool-edit-id').value = '';
                    document.getElementById('tool-image-preview').style.display = 'none';
                    try { window.postMessage({type: 'tools_updated'}, '*'); } catch(e) {}
                    loadServices();
                };
                reader.readAsDataURL(imageFile);
            } else {
                // No image selected, just save without image
                if (editId) {
                    const idx = tools.findIndex(t => t.id === parseInt(editId, 10));
                    if (idx > -1) {
                        toolObj.id = parseInt(editId, 10);
                        // preserve existing image if not replacing
                        if (tools[idx].image) toolObj.image = tools[idx].image;
                        tools[idx] = toolObj;
                        showMessage('services-success', 'Tool updated successfully!');
                    }
                } else {
                    toolObj.id = Math.max(...tools.map(t => t.id), 0) + 1;
                    tools.push(toolObj);
                    showMessage('services-success', 'Tool added successfully!');
                }
                
                localStorage.setItem('tools', JSON.stringify(tools));
                this.reset();
                document.getElementById('tool-edit-id').value = '';
                document.getElementById('tool-image-preview').style.display = 'none';
                try { window.postMessage({type: 'tools_updated'}, '*'); } catch(e) {}
                loadServices();
            }
        });

        document.getElementById('course-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const courses = JSON.parse(localStorage.getItem('courses'));
            const editId = document.getElementById('course-edit-id').value;
            const imageFile = document.getElementById('course-image').files[0];
            
            const courseObj = {
                name: document.getElementById('course-name').value,
                level: document.getElementById('course-level').value,
                icon: document.getElementById('course-icon').value,
                description: document.getElementById('course-description').value,
                image: '', // will be populated if image is selected
                button: {
                    text: document.getElementById('course-button-text').value.trim(),
                    type: document.getElementById('course-button-type').value,
                    target: document.getElementById('course-button-target').value.trim(),
                    icon: document.getElementById('course-button-icon').value.trim(),
                    color: document.getElementById('course-button-color').value
                }
            };
            
            // Handle image conversion to base64
            if (imageFile) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    courseObj.image = event.target.result; // base64 string
                    
                    if (editId) {
                        const idx = courses.findIndex(c => c.id === parseInt(editId, 10));
                        if (idx > -1) {
                            courseObj.id = parseInt(editId, 10);
                            courses[idx] = courseObj;
                            showMessage('services-success', 'Course updated successfully!');
                        }
                    } else {
                        courseObj.id = Math.max(...courses.map(c => c.id), 0) + 1;
                        courses.push(courseObj);
                        showMessage('services-success', 'Course added successfully!');
                    }
                    
                    localStorage.setItem('courses', JSON.stringify(courses));
                    document.getElementById('course-form').reset();
                    document.getElementById('course-edit-id').value = '';
                    document.getElementById('course-image-preview').style.display = 'none';
                    try { window.postMessage({type: 'courses_updated'}, '*'); } catch(e) {}
                    loadServices();
                };
                reader.readAsDataURL(imageFile);
            } else {
                // No image selected, just save without image
                if (editId) {
                    const idx = courses.findIndex(c => c.id === parseInt(editId, 10));
                    if (idx > -1) {
                        courseObj.id = parseInt(editId, 10);
                        // preserve existing image if not replacing
                        if (courses[idx].image) courseObj.image = courses[idx].image;
                        courses[idx] = courseObj;
                        showMessage('services-success', 'Course updated successfully!');
                    }
                } else {
                    courseObj.id = Math.max(...courses.map(c => c.id), 0) + 1;
                    courses.push(courseObj);
                    showMessage('services-success', 'Course added successfully!');
                }
                
                localStorage.setItem('courses', JSON.stringify(courses));
                this.reset();
                document.getElementById('course-edit-id').value = '';
                document.getElementById('course-image-preview').style.display = 'none';
                try { window.postMessage({type: 'courses_updated'}, '*'); } catch(e) {}
                loadServices();
            }
        });

        function deleteTool(id) {
            if (confirm('Delete this tool?')) {
                let tools = JSON.parse(localStorage.getItem('tools'));
                tools = tools.filter(t => t.id !== id);
                localStorage.setItem('tools', JSON.stringify(tools));
                showMessage('services-success', 'Tool deleted successfully!');
                loadServices();
            }
        }

        function editTool(id) {
            const tools = JSON.parse(localStorage.getItem('tools'));
            const tool = tools.find(t => t.id === id);
            if (!tool) return;
            document.getElementById('tool-name').value = tool.name || '';
            document.getElementById('tool-icon').value = tool.icon || '';
            document.getElementById('tool-description').value = tool.description || '';
            document.getElementById('tool-button-text').value = (tool.button && tool.button.text) ? tool.button.text : '';
            document.getElementById('tool-button-type').value = (tool.button && tool.button.type) ? tool.button.type : 'none';
            document.getElementById('tool-button-target').value = (tool.button && tool.button.target) ? tool.button.target : '';
            document.getElementById('tool-button-icon').value = (tool.button && tool.button.icon) ? tool.button.icon : '';
            document.getElementById('tool-button-color').value = (tool.button && tool.button.color) ? tool.button.color : '#9d4edd';
            // Show image preview if exists
            if (tool.image) {
                document.getElementById('tool-image-preview-img').src = tool.image;
                document.getElementById('tool-image-preview').style.display = 'block';
            } else {
                document.getElementById('tool-image-preview').style.display = 'none';
            }
            document.getElementById('tool-edit-id').value = tool.id;
            // switch to Services section in UI
            document.querySelectorAll('.menu-link').forEach(m => m.classList.remove('active'));
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            const svcLink = document.querySelector('.menu-link[data-section="services"]');
            if (svcLink) svcLink.classList.add('active');
            const svcSection = document.getElementById('services');
            if (svcSection) svcSection.classList.add('active');
            // change button label
            const toolBtn = document.querySelector('#tool-form .btn-primary');
            if (toolBtn) toolBtn.textContent = 'Save Tool';
            // show a small notice
            showMessage('services-success', 'Loaded tool into form for editing. Click Save to update.');
            showToast('Editing tool ‚Äî make changes and click Save');
            window.scrollTo({ top: 200, behavior: 'smooth' });
        }

        function deleteCourse(id) {
            if (confirm('Delete this course?')) {
                let courses = JSON.parse(localStorage.getItem('courses'));
                courses = courses.filter(c => c.id !== id);
                localStorage.setItem('courses', JSON.stringify(courses));
                showMessage('services-success', 'Course deleted successfully!');
                loadServices();
            }
        }

        function editCourse(id) {
            const courses = JSON.parse(localStorage.getItem('courses'));
            const course = courses.find(c => c.id === id);
            if (!course) return;
            document.getElementById('course-name').value = course.name || '';
            document.getElementById('course-level').value = course.level || 'Beginner';
            document.getElementById('course-icon').value = course.icon || '';
            document.getElementById('course-description').value = course.description || '';
            document.getElementById('course-button-text').value = (course.button && course.button.text) ? course.button.text : '';
            document.getElementById('course-button-type').value = (course.button && course.button.type) ? course.button.type : 'none';
            document.getElementById('course-button-target').value = (course.button && course.button.target) ? course.button.target : '';
            document.getElementById('course-button-icon').value = (course.button && course.button.icon) ? course.button.icon : '';
            document.getElementById('course-button-color').value = (course.button && course.button.color) ? course.button.color : '#9d4edd';
            // Show image preview if exists
            if (course.image) {
                document.getElementById('course-image-preview-img').src = course.image;
                document.getElementById('course-image-preview').style.display = 'block';
            } else {
                document.getElementById('course-image-preview').style.display = 'none';
            }
            document.getElementById('course-edit-id').value = course.id;
            // switch to Services section in UI
            document.querySelectorAll('.menu-link').forEach(m => m.classList.remove('active'));
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            const svcLink = document.querySelector('.menu-link[data-section="services"]');
            if (svcLink) svcLink.classList.add('active');
            const svcSection = document.getElementById('services');
            if (svcSection) svcSection.classList.add('active');
            // change button label
            const courseBtn = document.querySelector('#course-form .btn-primary');
            if (courseBtn) courseBtn.textContent = 'Save Course';
            showMessage('services-success', 'Loaded course into form for editing. Click Save to update.');
            showToast('Editing course ‚Äî make changes and click Save');
            window.scrollTo({ top: 400, behavior: 'smooth' });
        }

        // Settings Management
        document.getElementById('credentials-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const newUsername = document.getElementById('new-username').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;

            if (newPassword && newPassword !== confirmPassword) {
                alert('Passwords do not match!');
                return;
            }

            if (newUsername) {
                localStorage.setItem('admin_username', newUsername);
            }

            if (newPassword) {
                localStorage.setItem('admin_password', newPassword);
            }

            showMessage('settings-success', 'Credentials updated successfully!');
            this.reset();
        });

        // Social links management (load/save)
        function loadSocialLinksToForm() {
            const defaults = {
                github: 'https://github.com/your-username',
                fb_profile: 'https://facebook.com/your.profile',
                fb_page: 'https://facebook.com/your.page',
                instagram: 'https://instagram.com/yourusername',
                whatsapp: '',
                telegram: ''
            };

            let links = {};
            try {
                links = JSON.parse(localStorage.getItem('social_links')) || defaults;
            } catch (err) {
                links = defaults;
            }

            document.getElementById('github-input').value = links.github || '';
            document.getElementById('fb-profile-input').value = links.fb_profile || '';
            document.getElementById('fb-page-input').value = links.fb_page || '';
            document.getElementById('instagram-input').value = links.instagram || '';
            document.getElementById('whatsapp-input').value = links.whatsapp || '';
            document.getElementById('telegram-input').value = links.telegram || '';
        }

        document.getElementById('social-links-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const links = {
                github: document.getElementById('github-input').value.trim(),
                fb_profile: document.getElementById('fb-profile-input').value.trim(),
                fb_page: document.getElementById('fb-page-input').value.trim(),
                instagram: document.getElementById('instagram-input').value.trim(),
                whatsapp: document.getElementById('whatsapp-input').value.trim(),
                telegram: document.getElementById('telegram-input').value.trim()
            };
            localStorage.setItem('social_links', JSON.stringify(links));
            showMessage('settings-success', 'Social links saved!');
            // notify public page if open in same browser
            try { window.postMessage({type: 'social_links_updated'}, '*'); } catch(e) {}
        });

        // Initialize social links on dashboard load
        loadSocialLinksToForm();

        // Section buttons management (load/save)
        function loadSectionButtonsToForm() {
            const defaults = {
                tools: { text: 'Get Tool', type: 'none', target: '' },
                courses: { text: 'Enroll', type: 'none', target: '' }
            };
            let cfg = {};
            try { cfg = JSON.parse(localStorage.getItem('section_buttons')) || defaults; } catch(e) { cfg = defaults; }
            document.getElementById('tools-button-text').value = cfg.tools.text || '';
            document.getElementById('tools-button-type').value = cfg.tools.type || 'none';
            document.getElementById('tools-button-target').value = cfg.tools.target || '';
            document.getElementById('courses-button-text').value = cfg.courses.text || '';
            document.getElementById('courses-button-type').value = cfg.courses.type || 'none';
            document.getElementById('courses-button-target').value = cfg.courses.target || '';
        }

        document.getElementById('section-buttons-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const cfg = {
                tools: {
                    text: document.getElementById('tools-button-text').value.trim(),
                    type: document.getElementById('tools-button-type').value,
                    target: document.getElementById('tools-button-target').value.trim()
                },
                courses: {
                    text: document.getElementById('courses-button-text').value.trim(),
                    type: document.getElementById('courses-button-type').value,
                    target: document.getElementById('courses-button-target').value.trim()
                }
            };
            localStorage.setItem('section_buttons', JSON.stringify(cfg));
            showMessage('settings-success', 'Section buttons saved!');
            try { window.postMessage({type: 'section_buttons_updated'}, '*'); } catch(e) {}
        });

        loadSectionButtonsToForm();

        // Reset handlers: restore Add labels when forms are reset
        document.getElementById('tool-form').addEventListener('reset', function() {
            document.getElementById('tool-edit-id').value = '';
            const toolSubmit = document.querySelector('#tool-form .btn-primary');
            if (toolSubmit) toolSubmit.textContent = 'Add Tool';
            document.getElementById('tool-image-preview').style.display = 'none';
        });

        document.getElementById('course-form').addEventListener('reset', function() {
            document.getElementById('course-edit-id').value = '';
            const courseSubmit = document.querySelector('#course-form .btn-primary');
            if (courseSubmit) courseSubmit.textContent = 'Add Course';
            document.getElementById('course-image-preview').style.display = 'none';
        });

        // Image preview event listeners
        document.getElementById('tool-image').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    document.getElementById('tool-image-preview-img').src = event.target.result;
                    document.getElementById('tool-image-preview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                document.getElementById('tool-image-preview').style.display = 'none';
            }
        });

        document.getElementById('course-image').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    document.getElementById('course-image-preview-img').src = event.target.result;
                    document.getElementById('course-image-preview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                document.getElementById('course-image-preview').style.display = 'none';
            }
        });

        function showMessage(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
            setTimeout(() => {
                element.style.display = 'none';
            }, 4000);
        }

        // Small toast for quick confirmations (used when editing starts)
        function showToast(message) {
            const id = '__admin_toast';
            let t = document.getElementById(id);
            if (!t) {
                t = document.createElement('div');
                t.id = id;
                t.className = 'toast';
                document.body.appendChild(t);
            }
            t.textContent = message;
            t.classList.add('show');
            clearTimeout(t._hideTimer);
            t._hideTimer = setTimeout(() => {
                t.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
